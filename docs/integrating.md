# Integrating

## Adding the GitHub App

Add the **Build Cross Check** [GitHub App](https://github.com/apps/build-cross-check) to the repositories that you 
would like to work with.

## Create a token

In order to verify your build server, create a token to use when sending build logs.
After installing the application to your repo, head to **Build Cross Check** [web app](https://buildcrosscheck.azurewebsites.net/) 
and login with your GitHub account. There you will be able create a token per repository as well as
revoke prior tokens if necessary.

## Build Integration

### MSBuild Warnings and Errors

This example is based on AppVeyor, but this will work from any CI system. For more information see the documentation for [BCC-MSBuildLog](https://github.com/justaprogrammer/BCC-MSBuildLog/blob/master/docs/usage.md) and [BCC-Submssion](https://github.com/justaprogrammer/BCC-Submission/blob/master/docs/usage.md).

1. Install the GitHub App on the desired GitHub Repositories or Organizations.

1. Generate a token using the steps [above](#create-a-token) and set a [secure environment variable](https://www.appveyor.com/docs/build-configuration/#secure-variables) named `BCC_TOKEN`.

1. Add an install step to `appveyor.yml` to download **BCC-MSBuildLog** and **BCC-Submission** from Chocolately

   ```yml
   os: Visual Studio 2017
   install:
   - choco install --no-progress BCC-MSBuildLog
   - choco install --no-progress BCC-Submission
   ```

1. Configure your build to output a MSBuild binary log file

   ```yml
   build_script:
   - msbuild TestConsoleApp1.sln /bl:output.binlog
   ```

1. Use **BCC-MSBuildLog** and **BCC-Submission** to create and submit check run data to **Build Cross Check**.

   ```yml
   on_finish:
   - IF NOT "%BCC_TOKEN%x"=="x" BCCMSBuildLog --cloneRoot "%APPVEYOR_BUILD_FOLDER%" --input output.binlog --output checkrun.json --ownerRepo %APPVEYOR_REPO_NAME% --hash %APPVEYOR_REPO_COMMIT%
   - IF NOT "%BCC_TOKEN%x"=="x" BCCSubmission -h %APPVEYOR_REPO_COMMIT% -i checkrun.json -t %BCC_TOKEN%
   ```

1. Enjoy your warnings and errors.

### Custom Check Run Data

#### Example

Here is the output generated by **BCC-MSBuildLog** for [this](https://github.com/justaprogrammer/TestConsoleApp1/pull/1) Pull Request of `justaprogrammer/TestConsoleApp1`, our test application. It was used to generate [this](https://github.com/justaprogrammer/TestConsoleApp1/pull/1/checks?check_run_id=36879070) Check Run.

```
{
	"Name": "MSBuild Log",
	"Title": "0 errors - 1 warning",
	"Summary": "- [TestConsoleApp1/Program.cs(13)](https://github.com/justaprogrammer/TestConsoleApp1/tree/815aa7a3051cc0d0ae6c6c2c89cba125e8027d86/TestConsoleApp1/Program.cs#L13) **Warning - CS0219** The variable 'hello' is assigned but its value is never used\r\n",
	"Text": null,
	"Conclusion": 0,
	"Annotations": [{
			"Filename": "TestConsoleApp1/Program.cs",
			"CheckWarningLevel": 1,
			"Title": "CS0219: TestConsoleApp1/Program.cs(13)",
			"RawDetails": null,
			"Message": "The variable 'hello' is assigned but its value is never used",
			"StartLine": 13,
			"EndLine": 13
		}
	],
	"Images": null,
	"StartedAt": "2018-12-07T08:39:22.5858425-05:00",
	"CompletedAt": "2018-12-07T08:39:22.6347882-05:00"
}

```

#### Schema

##### CreateCheckRun <sub><sup>[src](https://github.com/justaprogrammer/BCC-Core/blob/master/src/BCC.Core/Model/CheckRunSubmission/CreateCheckRun.cs)</sup></sub>

##### CheckConclusion <sub><sup>[src](https://github.com/justaprogrammer/BCC-Core/blob/master/src/BCC.Core/Model/CheckRunSubmission/CheckConclusion.cs)</sup></sub>

##### Annotation <sub><sup>[src](https://github.com/justaprogrammer/BCC-Core/blob/master/src/BCC.Core/Model/CheckRunSubmission/Annotation.cs)</sup></sub>

##### CheckRunImage <sub><sup>[src](https://github.com/justaprogrammer/BCC-Core/blob/master/src/BCC.Core/Model/CheckRunSubmission/CheckRunImage.cs)</sup></sub>

### More coming soon...